"use strict";var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),drawHistoricalPlot=function(){function fetchHistoricalData(time){var start=void 0,end=void 0,_buildDateParams=buildDateParams(time),_buildDateParams2=_slicedToArray(_buildDateParams,2);start=_buildDateParams2[0],end=_buildDateParams2[1],fetch("https://api.coindesk.com/v1/bpi/historical/close.json?start="+start+"&end="+end,{method:"get"}).then(function(response){return response.json()}).then(function(data){plotHistoricalData(data)})}function plotHistoricalData(data){historicalData=[],storeResult(data);var _calculateHistoricalL=calculateHistoricalLimits(historicalData),_calculateHistoricalL2=_slicedToArray(_calculateHistoricalL,2);chartMin=_calculateHistoricalL2[0],chartMax=_calculateHistoricalL2[1],$(function(){var dataset;dataset=[{label:"USD/BTC",data:historicalData,color:"#00FF00"}],$.plot("#historicalPlot",dataset,getInitHistoricalOptions()),$("#historicalPlot").bind("plothover",function(event,pos,item){if(item){var x=item.datapoint[0],y=item.datapoint[1].toFixed(2);x=new Date(x);var date=new Date(x);x=date.getDate()+"/"+date.getMonth()+"/"+date.getFullYear(),$("#historicalTooltip").html(" Value on "+x+"<br><h3>$"+y+"</h3>").css("left",pos.pageX+2+"px").css("top",pos.pageY+2+"px").fadeIn(100)}else $("#historicalTooltip").hide()})})}function buildDateParams(time){var eDate,eYear,eMonth,sDate,sYear,sMonth,start,end,today=new Date;return eYear=today.getFullYear(),eMonth=today.getMonth()+1,eDate=today.getDate(),"1year"==time?(sMonth=eMonth,sDate=eDate,sYear=eYear-1):"6month"==time?(sMonth=eMonth-6<1?12-(eMonth-6):eMonth-6,sDate=eDate,sYear=eMonth-6<1?eYear-1:eYear):"3month"==time?(sMonth=eMonth-3<1?12-(eMonth-3):eMonth-3,sDate=eDate,sYear=eMonth-3<1?eYear-1:eYear):"1month"==time&&(sMonth=eMonth-1<1?12-(eMonth-1):eMonth-1,sDate=eDate,sYear=eMonth-1<1?eYear-1:eYear),sMonth=sMonth<10?"0"+sMonth:sMonth,eMonth=eMonth<10?"0"+eMonth:eMonth,sDate=sDate<10?"0"+sDate:sDate,eDate=eDate<10?"0"+eDate:eDate,start=sYear,end=eYear,end+="-"+eMonth+"-"+eDate,start+="-"+sMonth+"-"+sDate,eDate=today.getDate(),"1year"==time?(sMonth=eMonth,sDate=eDate,sYear=eYear-1):"6month"==time?(sMonth=eMonth-6<1?12-(eMonth-6):eMonth-6,sDate=eDate,sYear=eMonth-6<1?eYear-1:eYear):"3month"==time?(sMonth=eMonth-3<1?12-(eMonth-3):eMonth-3,sDate=eDate,sYear=eMonth-3<1?eYear-1:eYear):"1month"==time&&(sMonth=eMonth-1<1?12-(eMonth-1):eMonth-1,sDate=eDate,sYear=eMonth-1<1?eYear-1:eYear),sMonth=sMonth<10?"0"+sMonth:sMonth,eMonth=eMonth<10?"0"+eMonth:eMonth,sDate=sDate<10?"0"+sDate:sDate,eDate=eDate<10?"0"+eDate:eDate,start=sYear,end=eYear,end+="-"+eMonth+"-"+eDate,start+="-"+sMonth+"-"+sDate,[start,end]}function calculateHistoricalLimits(data){for(var max=0,min=Number.MAX_VALUE,i=0;i<data.length;i++)data[i][1]>max&&(max=data[i][1]),data[i][1]<min&&(min=data[i][1]);return[min,max]}function storeResult(data){for(var k in data.bpi){var fldate=k.split("-"),yr=parseInt(fldate[0]),mnth=parseInt(fldate[1]),dt=parseInt(fldate[2]),newDate=new Date(yr,mnth-1,dt,0,0,0,0);historicalData.push([newDate,data.bpi[k]])}}function getInitHistoricalOptions(){return{series:{lines:{show:!0,fill:!0},points:{show:!1}},grid:{hoverable:!0,clickable:!0},xaxis:{mode:"time",tickSize:[1,"day"],tickColor:"#FFFFFF",tickFormatter:function(v,axis){return""},axisLabel:"Time",axisLabelUseCanvas:!0,axisLabelFontSizePixels:12},yaxis:{min:chartMin+30,max:chartMax-30,axisLabelUseCanvas:!0,tickColor:"#FFFFFF"}}}var chartMin=void 0,chartMax=void 0,historicalData=[];fetchHistoricalData("1year"),$(function(){$("#timeDropdown").change(function(){fetchHistoricalData($("#timeDropdown option:selected").val())})})};