"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function getFormattedTime(v){var date=new Date(v);return(date.getHours()<10?"0"+date.getHours():date.getHours())+":"+(date.getMinutes()<10?"0"+date.getMinutes():date.getMinutes())+":"+(date.getSeconds()<10?"0"+date.getSeconds():date.getSeconds())}function getInitOptions(){return{series:{lines:{show:!0,lineWidth:1.2,fill:!1}},xaxis:{mode:"time",tickSize:[2,"second"],tickFormatter:function(v,axis){new Date(v);return""},axisLabel:"Time",axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelPadding:10},yaxis:{min:0,max:0,tickSize:10,axisLabel:"USD/BTC",axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelPadding:6},legend:{labelBoxBorderColor:"#fff"},grid:{backgroundColor:"#000000",hoverable:!0,clickable:!0}}}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),BTCApp=function(){function BTCApp(updateInterval,totalPoints,options){_classCallCheck(this,BTCApp),this.updateInterval=updateInterval,this.totalPoints=totalPoints,this.data=[],this.dataset=[{label:"USD/BTC",data:this.data,color:"#00FF00"}],this.options=options,this.count=0,this.currentMax=0,this.currentMin=Number.MAX_VALUE,this.historicalData=[],this.now=new Date}return _createClass(BTCApp,[{key:"setLiveEventListeners",value:function(){$("#flot-placeholder1").bind("plothover",function(event,pos,item){if(item){var x=getFormattedTime(item.datapoint[0]),y=item.datapoint[1].toFixed(2);$("#tooltipLive").html("Value at "+x+"<br><h3>$"+y+"</h3>").css("left",pos.pageX+2+"px").css("top",pos.pageY+2+"px").fadeIn(500)}else $("#tooltipLive").hide()})}},{key:"updatePriceView",value:function(price){$("#num").html("$<strong>"+price+"</strong>")}},{key:"getDataFromAPI",value:function(currentTime){var _this=this,btcValues=void 0;$.ajax({type:"GET",url:"https://blockchain.info/ticker",data:{},success:function(response){btcValues=response},error:function(){}}).done(function(){_this.updatePriceView(btcValues.USD.last),_this.pushToPlot([currentTime,btcValues.USD.last])})}},{key:"GetData",value:function(){var now=(new Date).getTime();this.now=now,this.getDataFromAPI(this.now+=this.updateInterval)}},{key:"updatePlotRange",value:function(dataPoint){dataPoint[1]>this.currentMax?(this.options.yaxis.max=dataPoint[1]+10,this.currentMax=this.options.yaxis.max):dataPoint[1]<this.currentMin&&(this.options.yaxis.min=dataPoint[1]-10,this.currentMin=this.options.yaxis.min)}},{key:"pushToPlot",value:function(dataPoint){var _this2=this;this.data.push(dataPoint),this.count++,this.updatePlotRange(dataPoint),this.update(),this.count>this.totalPoints&&(this.data.shift(),this.count=0),setTimeout(function(){_this2.getDataFromAPI(_this2.now+=_this2.updateInterval)},this.updateInterval)}},{key:"update",value:function(){$.plot($("#flot-placeholder1"),this.dataset,this.options)}},{key:"initApp",value:function(){this.setLiveEventListeners(),drawHistoricalPlot(),this.GetData()}}]),BTCApp}();$(document).ready(function(){new BTCApp(1e3,50,getInitOptions()).initApp()});